# 02: RED（失敗テスト）を書く — TDDの起点

本章は、TDDの最初のステップ（RED）として失敗するテストを書き、期待振る舞いを固定する手順を示します。

## 目的
- 受入基準（Given-When-Then）をテストで具体化し、仕様の曖昧さを排除
- 実装前に期待結果を固定し、最小実装で到達すべきゴールを明確化

## 前提
- 01章でドラフトPRが作成され、PR本文に「開発計画（必須）」が記載されている
- 対象の層（Unit/Integration/E2E）が開発計画で決まっている

## 完了条件（DoD）
- 追加したテストが現状では失敗する（RED）ことを確認
- 受入基準がテスト名/説明/期待で明瞭に表現されている

## 手順
1) テスト層の選定
- Unit: ピュアロジック/コンポーネント/バリデーション（高速・局所）
- Integration: API〜DB/Redis の協調（testcontainers 等を活用）
- E2E: ユーザーフロー（必要最小限、Playwright）

2) 受入基準の定義（例）
- Given: 前提状態（DBシード/モック/画面状態）
- When: 操作（API呼び出し/フォーム操作/ボタン押下）
- Then: 期待結果（HTTPコード/JSON/画面表示/遷移/副作用）

3) テスト実装（RED）
- 命名: `<対象>.<目的>.<条件>.spec.ts(x)`
- データ: Factory/Builder を用いて最小データで再現
- 実行: `pnpm test:unit` / `pnpm test:integration` / `pnpm test:e2e`

## チェックリスト
- [ ] 受入基準をテストで言語化できている
- [ ] RED を確認（少なくとも1件は失敗）
- [ ] 偽陽性を避けるため、期待の検証が十分に具体的

## よくある落とし穴
- 複数要件を一度にテスト → 失敗原因の切り分けが困難
- モック過多/不足 → 単体/統合の境界が曖昧になり、信頼性低下
- E2Eで過剰な網羅 → 実行時間/不安定性増大（主要フローに限定）

## 関連リンク
- 開発者ガイド: 5.0 開発フロー、5.1 TDD（`docs/04_developer_guide.md`）
- テスト戦略: `docs/05_testing_strategy.md`
