# AIエージェント実行ガイドライン

AIエージェントが自律的にタスクを判断・実行するためのガイドラインです。

## 1. コア原則

- **自律実行**: 確認は最小限にし、即座に着手します。
- **品質維持**: 既存のコード品質と一貫性を維持し、自動チェックを徹底します。
- **既存優先**: 新規作成より既存ファイルの編集を優先します。
- **事実確認**: 憶測を避け、情報源を自ら確認します。

## 2. 実行ルール

### 即時実行（確認不要）

- **コード**: バグ修正、リファクタリング、パフォーマンス改善
- **ファイル**: 既存ファイルの修正・更新
- **テスト**: 単体・統合テストの実装（TDD）
- **依存関係**: パッケージの追加・更新・削除

### 確認必須

- **新規ファイル作成・削除**
- **大規模な構造変更**（アーキテクチャ、フォルダ構成）
- **外部連携**（新規API、ライブラリ導入）
- **セキュリティ・DBスキーマ・本番環境**の変更

## 3. 開発ワークフロー

- **TDDサイクル**: Red (失敗テスト) → Green (最小実装) → Refactor (改善) のサイクルを遵守します。
- **変更管理**: **構造変更**（リファクタリング等）と**動作変更**（機能追加・修正）を同一コミットに含めません。
- **コミット**: 全テストがパスし、警告がゼロの状態で、単一の論理的作業単位ごとに行います。
- **実装**: シンプルな実装から始め、テストでカバーした後にリファクタリングで改善します。

## 4. 品質基準

- **設計**: 単一責任の原則、疎結合を意識します。
- **コード**: 重複を排除し（DRY）、ハードコーディングを避けます（設定は定数や環境変数へ）。
- **エラーハンドリング**: 実行不可能な場合は代替案を3つ提示し、部分実行可能な場合は完了部分と残課題を明示します。

## 5. タスク実行の制約

- **Web検索**: 禁止。`gemini --prompt "WebSearch: <クエリ>"` を使用
- **vitest**: `npx vitest run [ファイル名]` のみ（インタラクティブモード禁止）
- **開発サーバー**: 禁止。静的チェック（`npm run build`, `npm run lint`, `npx tsc --noEmit`）を使用
- **Docker必須**: すべてのnpm操作、playwright テスト、スクリーンショットはDockerコンテナ内で実行
  - playwright: `docker exec hime-sagashi-playwright-mcp-1 npx playwright test [ファイル]`
  - スクリーンショット: `docker exec hime-sagashi-playwright-mcp-1 node /workspace/screenshot-manager.js take <URL> <basename>`
- **保存先**: スクリーンショットは `screenshot/YYYYMMDD_HHmmssSSS_basename.png` 形式で保存

## 6. 完了報告

- **部分完了**: "## 実行完了\n### 変更内容\n- [詳細]\n### 次のステップ\n- [作業]"
- **完全完了**: "May the Force be with you."

## 7. カスタムコマンド

`.claude/commands/` 内利用可能: **claude-update**（ガイドライン更新）、**pr-create**（自動PR作成）。コマンドはユーザーと**日本語**で対話、ドキュメントは英語で効率化。
